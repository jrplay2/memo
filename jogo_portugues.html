<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portugu√™s - Quiz Educativo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #e17055 0%, #d63031 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .game-header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .game-title {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .game-controls {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
        }

        .timer {
            background: rgba(255,255,255,0.2);
            padding: 10px 20px;
            border-radius: 25px;
            color: white;
            font-size: 1.2em;
            font-weight: bold;
        }

        .start-btn {
            background: #00b894;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .start-btn:hover {
            background: #00a085;
            transform: translateY(-2px);
        }

        .back-btn {
            background: #636e72;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            background: #2d3436;
            transform: translateY(-2px);
        }

        .help-btn {
            background: #fdcb6e;
            color: #2d3436;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-left: 10px;
        }

        .help-btn:hover {
            background: #f39c12;
            transform: translateY(-1px);
        }

        .cards-container {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            perspective: 1000px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .card {
            width: 250px;
            height: 350px;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s;
        }

        .card.flipped {
            transform: rotateY(180deg);
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            font-weight: bold;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }

        .card-front {
            background: linear-gradient(135deg, #ddd6fe 0%, #c4b5fd 100%);
            color: #5b21b6;
        }

        .card-back {
            background: linear-gradient(135deg, #fef3c7 0%, #fbbf24 100%);
            color: #92400e;
            transform: rotateY(180deg);
            padding: 20px;
            text-align: center;
            font-size: 1em;
        }

        .question-container {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 30px;
            max-width: 800px;
            width: 100%;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .question-text {
            font-size: 1.3em;
            color: #2d3436;
            margin-bottom: 25px;
            line-height: 1.6;
        }

        .options-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .option-btn {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            font-size: 1em;
        }

        .option-btn:hover {
            background: #e9ecef;
            border-color: #adb5bd;
        }

        .option-btn.correct {
            background: #d4edda;
            border-color: #28a745;
            color: #155724;
        }

        .option-btn.incorrect {
            background: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }

        .progress-container {
            width: 100%;
            max-width: 800px;
            background: rgba(255,255,255,0.3);
            border-radius: 25px;
            height: 10px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: #00b894;
            border-radius: 25px;
            transition: width 0.5s ease;
            width: 0%;
        }

        .stats-container {
            background: rgba(255,255,255,0.9);
            border-radius: 15px;
            padding: 20px;
            max-width: 800px;
            width: 100%;
            text-align: center;
            color: #2d3436;
        }

        .stats-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            font-size: 1em;
        }

        .bounce {
            animation: bounce 0.6s ease-in-out;
        }

        @keyframes bounce {
            0%, 20%, 60%, 100% {
                transform: translateY(0) rotateY(180deg);
            }
            40% {
                transform: translateY(-20px) rotateY(180deg);
            }
            80% {
                transform: translateY(-10px) rotateY(180deg);
            }
        }

        .help-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        @keyframes fadeInOut {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
            50% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
        }

        .help-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 700px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .close-help {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            position: absolute;
            right: 15px;
            top: 15px;
        }

        .close-help:hover {
            color: #000;
        }

        .text-reference {
            background: #f8f9fa;
            border-left: 4px solid #e17055;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
            font-style: italic;
            line-height: 1.6;
        }

        @media (max-width: 768px) {
            .cards-container {
                flex-direction: column;
                align-items: center;
            }
            
            .options-container {
                grid-template-columns: 1fr;
            }
            
            .game-controls {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="game-header">
        <h1 class="game-title">üìö Quiz de Portugu√™s</h1>
        <p>Teste seus conhecimentos sobre a cr√¥nica "A Velhinha Contrabandista"</p>
    </div>

    <div class="game-controls">
        <div class="timer" id="timer">‚è±Ô∏è 00:00</div>
        <button class="start-btn" id="startBtn" onclick="startGame()">üöÄ Iniciar Quiz</button>
        <button class="back-btn" onclick="goBack()">‚¨ÖÔ∏è Voltar aos Temas</button>
    </div>

    <div class="progress-container">
        <div class="progress-fill" id="progressFill"></div>
    </div>

    <div class="cards-container">
        <div class="card" id="questionCard">
            <div class="card-face card-front">
                <div>‚ùì Pergunta</div>
            </div>
            <div class="card-face card-back">
                <div id="questionText">Clique em "Iniciar Quiz" para come√ßar!</div>
            </div>
        </div>
        
        <div class="card" id="answerCard">
            <div class="card-face card-front">
                <div>üí° Resposta</div>
            </div>
            <div class="card-face card-back">
                <div id="answerText">A resposta aparecer√° aqui</div>
            </div>
        </div>
        
        <div class="card" id="imageCard">
            <div class="card-face card-front">
                <div>üìñ Texto</div>
            </div>
            <div class="card-face card-back">
                <div class="image-content">
                    <img id="themeImage" alt="Imagem educativa" style="max-width:100%; height:auto; display:none; border-radius:8px;" />
                    <div id="imageText">Refer√™ncia do texto aparecer√° aqui</div>
                </div>
            </div>
        </div>
    </div>

    <div class="question-container" id="questionContainer" style="display: none;">
        <div class="question-header">
            <h3 id="questionNumber">Quest√£o 1</h3>
            <button class="help-btn" id="helpBtn" onclick="showHelp()">üí° Ajuda</button>
        </div>
        <div class="question-text" id="questionTextMain"></div>
        <div class="options-container">
            <button class="option-btn" id="optionA" onclick="selectAnswer('A')"></button>
            <button class="option-btn" id="optionB" onclick="selectAnswer('B')"></button>
            <button class="option-btn" id="optionC" onclick="selectAnswer('C')"></button>
            <button class="option-btn" id="optionD" onclick="selectAnswer('D')"></button>
        </div>
    </div>

    <div class="stats-container">
        <h3>üìä Estat√≠sticas do Jogo</h3>
        <div class="stats-content" id="statsContent">
            <div>Clique em "Iniciar Quiz" para come√ßar!</div>
        </div>
    </div>

    <!-- Modal de Ajuda -->
    <div id="helpModal" class="help-modal">
        <div class="help-content">
            <span class="close-help" onclick="closeHelp()">&times;</span>
            <h3>üí° Ajuda - Quest√£o <span id="helpQuestionNumber"></span></h3>
            <div id="helpText"></div>
            <div class="text-reference">
                <h4>üìñ Texto de Refer√™ncia:</h4>
                <div id="textReference"></div>
            </div>
        </div>
    </div>

    <script>
        // Vari√°veis globais
        let currentQuestionIndex = 0;
        let startTime = 0;
        let timerInterval;
        let gameStartTime = 0;
        let gameStats = {
            questionsAnswered: 0,
            correctAnswers: 0,
            totalTime: 0
        };
        let incorrectQuestions = [];
        let allQuestions = [];
        let currentRound = 1;
        let gameHistory = JSON.parse(localStorage.getItem('portuguesGameHistory') || '[]');

        // Texto da cr√¥nica
        const cronicaText = `A VELHINHA CONTRABANDISTA\nStanislaw Ponte Preta\n\nDiz que era uma velhinha que sabia andar de lambreta. Todo dia, ela passava na fronteira montada na lambreta, com um bruto saco atr√°s da lambreta. O pessoal da alf√¢ndega ‚Äì tudo malandro velho ‚Äì come√ßou a desconfiar da velhinha. Um dia, quando ela vinha na lambreta com o saco atr√°s, o fiscal da alf√¢ndega mandou ela parar.\n\nA velhinha parou e ent√£o o fiscal perguntou assim pra ela: ‚Äî Escuta aqui, vovozinha, a senhora passa por aqui todo dia, com esse saco a√≠ atr√°s. Que diabo a senhora leva nesse saco?\n\nA velhinha sorriu com os poucos dentes que lhe restavam e mais os outros, que ela adquiriu no odont√≥logo, e respondeu: ‚Äî √â areia!\n\nA√≠ quem sorriu foi o fiscal. Achou que n√£o era areia nenhuma e mandou a velhinha saltar da lambreta para examinar o saco. A velhinha saltou, o fiscal esvaziou o saco e dentro s√≥ tinha areia. Muito encabulado, ordenou √† velhinha que fosse em frente. Ela montou na lambreta e foi embora, com o saco de areia atr√°s.\n\nMas o fiscal ficou desconfiado ainda. Talvez a velhinha passasse um dia com areia e no outro com muamba, dentro daquele maldito saco. No dia seguinte, quando ela passou na lambreta com o saco atr√°s, o fiscal mandou parar outra vez. Perguntou o que √© que ela levava no saco e ela respondeu que era areia, uai!\n\nO fiscal examinou e era mesmo. Durante um m√™s seguido, o fiscal interceptou a velhinha e, todas as vezes, o que ela levava no saco era areia. Diz que foi a√≠ que o fiscal se chateou: ‚Äî Olhe, vovozinha, eu sou fiscal de alf√¢ndega com 40 anos de servi√ßo. Manjo essa coisa de contrabando pra burro. Ningu√©m me tira da cabe√ßa que a senhora √© contrabandista. ‚Äî Mas no saco s√≥ tem areia! ‚Äì insistiu a velhinha.\n\nE j√° ia tocar a lambreta, quando o fiscal prop√¥s: ‚Äî Eu prometo √† senhora que deixo a senhora passar. N√£o dou parte, n√£o apreendo, n√£o conto nada a ningu√©m, mas a senhora vai me dizer: qual √© o contrabando que a senhora est√° passando por aqui todos os dias? ‚Äî O senhor promete que n√£o "espaia"? ‚Äì quis saber a velhinha. ‚Äî Juro ‚Äì respondeu o fiscal. ‚Äî √â lambreta!`;

        // Quest√µes do quiz
        const questions = [
            {
                question: 'Em "A velhinha contrabandista", o texto √© classificado como:',
                options: ['Poema', 'Cr√¥nica', 'Reportagem', 'F√°bula'],
                correct: 1,
                explanation: 'A cr√¥nica √© um tipo de texto que narra acontecimentos do dia a dia de uma forma pessoal, leve e, muitas vezes, com humor. O autor observa uma cena comum (uma velhinha atravessando a fronteira) e a transforma em uma pequena hist√≥ria com uma reviravolta engra√ßada. Diferente de uma reportagem, que busca ser totalmente objetiva, a cr√¥nica tem a vis√£o do autor. E diferente de um poema, n√£o √© escrita em versos.',
                answer: 'Cr√¥nica',
                reference: 'Todo o texto',
                image: 'https://api.iconify.design/mdi/book-open-page-variant.svg?height=256&color=%230066cc',
                imageAlt: 'G√™neros Textuais: √≠cone de livro'
            },
            {
                question: 'O foco narrativo predominante na cr√¥nica √©:',
                options: ['Segunda pessoa', 'Terceira pessoa', 'Primeira pessoa', 'Indefinido'],
                correct: 1,
                explanation: 'O foco narrativo em terceira pessoa ocorre quando a hist√≥ria √© contada por algu√©m que n√£o participa dela. Esse narrador √© como um observador, que descreve as a√ß√µes dos personagens usando os pronomes "ele" (o fiscal) e "ela" (a velhinha). Se fosse em primeira pessoa, o fiscal ou a velhinha contaria a hist√≥ria dizendo "eu fiz isso" ou "eu vi aquilo". Como o narrador est√° "de fora", a narra√ß√£o √© em terceira pessoa.',
                answer: 'Terceira pessoa',
                reference: 'Observe os pronomes usados: "ela passava", "o fiscal perguntou", "A velhinha parou"',
                image: 'https://api.iconify.design/mdi/eye.svg?height=256&color=%230066cc',
                imageAlt: 'Foco Narrativo: √≠cone de olho'
            },
            {
                question: 'O efeito de humor na cr√¥nica surge principalmente por:',
                options: ['Descri√ß√µes tristes', 'Exageros e ironia', 'Instru√ß√µes t√©cnicas', 'Rimas'],
                correct: 1,
                explanation: 'O humor do texto nasce da ironia e da quebra de expectativa. A ironia est√° no fato de a velhinha ser uma "contrabandista" de algo sem valor nenhum (areia). O fiscal cria uma enorme expectativa, agindo com autoridade e desconfian√ßa exagerada, pensando que descobriria um grande crime. A gra√ßa acontece quando essa expectativa √© quebrada no final, revelando que todo o esfor√ßo e a suspeita do fiscal foram por nada, o que torna a situa√ß√£o c√¥mica.',
                answer: 'Exageros e ironia',
                reference: 'Final da hist√≥ria: "‚Äî √â lambreta!" - a revela√ß√£o inesperada',
                image: 'https://api.iconify.design/fa-solid/theater-masks.svg?height=256&color=%230066cc',
                imageAlt: 'Humor Liter√°rio: m√°scaras de teatro'
            },
            {
                question: 'Em "Eu prometo e exijo: diga o que est√° passando por aqui todos os dias!", h√° um fiscal:',
                options: ['Desatento', 'Autorit√°rio e desconfiado', 'Com medo', 'Em d√∫vida sobre o local'],
                correct: 1,
                explanation: 'A postura do fiscal √© de quem tem o poder e n√£o confia na velhinha. Ele n√£o pede, ele "exige". Suas a√ß√µes, como revirar o saco de areia e inspecionar os dentes dela, mostram sua desconfian√ßa. Ele est√° convencido de que h√° um crime acontecendo e usa sua autoridade para tentar provar isso a qualquer custo, o que o caracteriza como autorit√°rio.',
                answer: 'Autorit√°rio e desconfiado',
                reference: '"Manjo essa coisa de contrabando pra burro. Ningu√©m me tira da cabe√ßa que a senhora √© contrabandista."',
                image: 'https://api.iconify.design/mdi/police-badge.svg?height=256&color=%230066cc',
                imageAlt: 'Caracteriza√ß√£o: distintivo de pol√≠cia'
            },
            {
                question: 'O termo que melhor resume o desfecho da cr√¥nica √©:',
                options: ['Suspense', 'Mist√©rio', 'Surpresa', 'Trag√©dia'],
                correct: 2,
                explanation: 'O desfecho (o final) da hist√≥ria √© surpreendente porque revela algo que ningu√©m esperava. Durante toda a leitura, somos levados a acreditar, junto com o fiscal, que a velhinha escondia algo valioso ou ilegal. A revela√ß√£o de que ela contrabandeava apenas "areia" √© uma reviravolta totalmente inesperada, que fecha a hist√≥ria de forma leve e engra√ßada, caracter√≠stica principal de um final surpreendente.',
                answer: 'Surpresa',
                reference: '"‚Äî √â lambreta!" - A revela√ß√£o final que ningu√©m esperava',
                image: 'https://api.iconify.design/mdi/emoticon-surprised-outline.svg?height=256&color=%230066cc',
                imageAlt: 'Desfecho: rosto surpreso'
            }
        ];

        // Fun√ß√£o para iniciar o jogo
        function startGame() {
            currentQuestionIndex = 0;
            incorrectQuestions = [];
            allQuestions = [...Array(questions.length).keys()]; // [0, 1, 2, 3, 4]
            currentRound = 1;
            gameStartTime = Date.now();
            gameStats = {
                questionsAnswered: 0,
                correctAnswers: 0,
                totalTime: 0
            };
            
            // Resetar todas as cartas
            document.getElementById('questionCard').classList.remove('flipped');
            document.getElementById('answerCard').classList.remove('flipped');
            document.getElementById('imageCard').classList.add('flipped');
            
            document.getElementById('questionContainer').style.display = 'block';
            document.getElementById('startBtn').style.display = 'none';
            showQuestion();
        }

        // Fun√ß√£o para mostrar a pergunta atual
        function showQuestion() {
            // Se n√£o h√° mais quest√µes na rodada atual
            if (allQuestions.length === 0) {
                // Se h√° quest√µes incorretas, iniciar nova rodada com elas
                if (incorrectQuestions.length > 0) {
                    allQuestions = [...incorrectQuestions];
                    incorrectQuestions = [];
                    currentRound++;
                    currentQuestionIndex = allQuestions.shift();
                } else {
                    // Todas as quest√µes foram respondidas corretamente
                    showFinalResults();
                    return;
                }
            } else {
                // Pegar pr√≥xima quest√£o da rodada atual
                currentQuestionIndex = allQuestions.shift();
            }

            const question = questions[currentQuestionIndex];
            
            // Reset das cartas - apenas resposta e imagem
            document.getElementById('answerCard').classList.remove('flipped');
            document.getElementById('imageCard').classList.remove('flipped');
            
            // Reset do conte√∫do visual da terceira carta (imagem/texto)
            const imgEl = document.getElementById('themeImage');
            const textEl = document.getElementById('imageText');
            if (imgEl) {
                imgEl.src = '';
                imgEl.style.display = 'none';
            }
            if (textEl) {
                textEl.style.display = 'block';
                textEl.textContent = 'Refer√™ncia do texto aparecer√° aqui';
            }
            
            // Popular imagem imediatamente para a quest√£o atual
            if (imgEl && textEl) {
                if (question.image && /^https?:\/\//.test(question.image)) {
                    textEl.style.display = 'none';
                    imgEl.style.display = 'block';
                    imgEl.alt = question.imageAlt || 'Imagem educativa';
                    
                    imgEl.onerror = () => {
                        imgEl.style.display = 'none';
                        textEl.style.display = 'block';
                        textEl.textContent = question.reference || 'Refer√™ncia do texto';
                    };
                    
                    imgEl.onload = () => {
                        textEl.style.display = 'none';
                        imgEl.style.display = 'block';
                    };
                    
                    imgEl.src = question.image;
                } else {
                    imgEl.src = '';
                    imgEl.style.display = 'none';
                    textEl.style.display = 'block';
                    textEl.textContent = question.reference || 'Refer√™ncia do texto';
                }
            }
            
            // Mostrar a primeira carta (pergunta) ap√≥s um pequeno delay
            setTimeout(() => {
                document.getElementById('questionCard').classList.add('flipped');
                document.getElementById('questionText').textContent = question.question;
            }, 300);
            
            // Limpar op√ß√µes anteriores
            const options = document.querySelectorAll('.option-btn');
            options.forEach(btn => {
                btn.classList.remove('correct', 'incorrect');
                btn.disabled = false;
            });

            // Mostrar pergunta de m√∫ltipla escolha
            showMultipleChoiceQuestion(question);

            // Atualizar progresso
            updateProgress();
            
            // Iniciar cron√¥metro
            startTimer();
        }

        // Fun√ß√£o para mostrar pergunta de m√∫ltipla escolha
        function showMultipleChoiceQuestion(question) {
            document.getElementById('questionNumber').textContent = `Quest√£o ${currentQuestionIndex + 1}`;
            document.getElementById('questionTextMain').textContent = question.question;
            
            const options = document.querySelectorAll('.option-btn');
            options.forEach((btn, index) => {
                btn.textContent = `${String.fromCharCode(97 + index)}) ${question.options[index]}`;
            });
        }

        // Fun√ß√£o para iniciar o cron√¥metro
        function startTimer() {
            startTime = Date.now();
            timerInterval = setInterval(updateTimer, 100);
        }

        // Fun√ß√£o para atualizar o cron√¥metro
        function updateTimer() {
            const elapsed = Date.now() - startTime;
            const seconds = Math.floor(elapsed / 1000);
            const milliseconds = Math.floor((elapsed % 1000) / 100);
            document.getElementById('timer').textContent = `‚è±Ô∏è ${seconds.toString().padStart(2, '0')}:${milliseconds}`;
        }

        // Fun√ß√£o para parar o cron√¥metro
        function stopTimer() {
            clearInterval(timerInterval);
            return Date.now() - startTime;
        }

        // Fun√ß√£o para selecionar resposta
        function selectAnswer(selectedOption) {
            const timeSpent = stopTimer();
            const question = questions[currentQuestionIndex];
            
            // Converter letra para √≠ndice (A=0, B=1, C=2, D=3)
            const selectedIndex = selectedOption.charCodeAt(0) - 65;
            const isCorrect = selectedIndex === question.correct;
            
            // Desabilitar todas as op√ß√µes
            const options = document.querySelectorAll('.option-btn');
            options.forEach(btn => btn.disabled = true);
            
            // Marcar apenas a resposta selecionada
            const selectedBtn = document.getElementById(`option${selectedOption}`);
            selectedBtn.classList.add(isCorrect ? 'correct' : 'incorrect');
            
            // Se errou, adicionar √† lista de quest√µes incorretas
            if (!isCorrect) {
                if (!incorrectQuestions.includes(currentQuestionIndex)) {
                    incorrectQuestions.push(currentQuestionIndex);
                }
                // Mostrar feedback de erro sem revelar a resposta correta
                showErrorFeedback();
            } else {
                // Se acertou, mostrar as cartas de resposta e imagem
                showCorrectFeedback(question);
            }

            // Atualizar estat√≠sticas
            gameStats.questionsAnswered++;
            gameStats.totalTime += timeSpent;
            if (isCorrect) {
                gameStats.correctAnswers++;
            }

            // Atualizar estat√≠sticas na tela
            updateGameStats(timeSpent, isCorrect);
            
            // Pr√≥xima pergunta ap√≥s delay apropriado
            const delay = isCorrect ? 3000 : 1500; // Menos tempo se errou
            setTimeout(() => {
                showQuestion();
            }, delay);
        }
        
        // Fun√ß√£o para mostrar feedback de erro
        function showErrorFeedback() {
            // Apenas mostrar que errou, sem revelar a resposta
            const errorMsg = document.createElement('div');
            errorMsg.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: #ff4444;
                color: white;
                padding: 20px;
                border-radius: 10px;
                font-size: 18px;
                z-index: 1000;
                animation: fadeInOut 1.5s ease-in-out;
            `;
            errorMsg.textContent = '‚ùå Resposta incorreta! Tente novamente mais tarde.';
            document.body.appendChild(errorMsg);
            
            setTimeout(() => {
                document.body.removeChild(errorMsg);
            }, 1500);
        }
        
        // Fun√ß√£o para mostrar feedback de acerto
        function showCorrectFeedback(question) {
            // Revelar segunda carta (resposta) se acertou
            setTimeout(() => {
                document.getElementById('answerCard').classList.add('flipped');
                document.getElementById('answerCard').classList.add('bounce');
                document.getElementById('answerText').textContent = question.answer;
            }, 1000);
            
            // Revelar terceira carta (imagem/conceito) ap√≥s a resposta
            setTimeout(() => {
                const imageCard = document.getElementById('imageCard');
                const imgEl = document.getElementById('themeImage');
                const textEl = document.getElementById('imageText');
                
                // A terceira carta j√° est√° virada mostrando a imagem; apenas aplicar anima√ß√£o
                imageCard.classList.add('bounce');
                
                // Se houver URL de imagem (SVG), mostrar a imagem; caso contr√°rio, mostrar texto de refer√™ncia
                if (question.image && /^https?:\/\//.test(question.image)) {
                    textEl.style.display = 'none';
                    imgEl.style.display = 'block';
                    imgEl.alt = question.imageAlt || 'Imagem educativa';
                    
                    imgEl.onerror = () => {
                        imgEl.style.display = 'none';
                        textEl.style.display = 'block';
                        textEl.textContent = question.reference || 'Refer√™ncia do texto';
                    };
                    
                    imgEl.onload = () => {
                        textEl.style.display = 'none';
                        imgEl.style.display = 'block';
                    };
                    
                    imgEl.src = question.image;
                } else {
                    imgEl.src = '';
                    imgEl.style.display = 'none';
                    textEl.style.display = 'block';
                    textEl.textContent = question.reference || 'Refer√™ncia do texto';
                }
            }, 2000);
        }

        // Fun√ß√£o para atualizar progresso
        function updateProgress() {
            // Calcular progresso baseado nas quest√µes respondidas corretamente
            const totalQuestions = questions.length;
            const questionsRemaining = incorrectQuestions.length;
            const questionsCompleted = totalQuestions - questionsRemaining;
            const progress = (questionsCompleted / totalQuestions) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }

        // Fun√ß√£o para atualizar estat√≠sticas do jogo
        function updateGameStats(timeSpent, isCorrect) {
            const avgTime = gameStats.totalTime / gameStats.questionsAnswered;
            const accuracy = (gameStats.correctAnswers / gameStats.questionsAnswered * 100).toFixed(1);
            const questionsInCurrentRound = allQuestions.length + 1; // +1 porque j√° removemos a atual
            const totalQuestionsRemaining = allQuestions.length + incorrectQuestions.length;
            const gameTimeElapsed = Math.floor((Date.now() - gameStartTime) / 1000);
            
            document.getElementById('statsContent').innerHTML = `
                <div>üîÑ Rodada atual: ${currentRound}</div>
                <div>üìù Quest√µes nesta rodada: ${questionsInCurrentRound}</div>
                <div>‚ùì Total de quest√µes restantes: ${totalQuestionsRemaining}</div>
                <div>‚úÖ Acertos consecutivos: ${gameStats.correctAnswers}</div>
                <div>üéØ Precis√£o: ${accuracy}%</div>
                <div>‚è±Ô∏è Tempo de jogo: ${formatTime(gameTimeElapsed)}</div>
                <div>üïê √öltima resposta: ${(timeSpent/1000).toFixed(1)}s ${isCorrect ? '‚úÖ' : '‚ùå'}</div>
            `;
        }

        // Fun√ß√£o para mostrar resultados finais
        function showFinalResults() {
            const totalGameTime = Date.now() - gameStartTime;
            const totalGameTimeSeconds = Math.floor(totalGameTime / 1000);
            const accuracy = (gameStats.correctAnswers / gameStats.questionsAnswered * 100).toFixed(1);
            const avgTime = (gameStats.totalTime / gameStats.questionsAnswered / 1000).toFixed(1);
            
            // Salvar no hist√≥rico
            const gameResult = {
                date: new Date().toLocaleDateString('pt-BR'),
                time: new Date().toLocaleTimeString('pt-BR'),
                totalTime: totalGameTimeSeconds,
                accuracy: parseFloat(accuracy),
                rounds: currentRound,
                questionsAnswered: gameStats.questionsAnswered
            };
            
            gameHistory.unshift(gameResult);
            if (gameHistory.length > 5) {
                gameHistory = gameHistory.slice(0, 5);
            }
            localStorage.setItem('portuguesGameHistory', JSON.stringify(gameHistory));
            
            // Determinar posi√ß√£o no ranking
            const sortedHistory = [...gameHistory].sort((a, b) => a.totalTime - b.totalTime);
            const currentPosition = sortedHistory.findIndex(game => 
                game.totalTime === totalGameTimeSeconds && 
                game.accuracy === parseFloat(accuracy)
            ) + 1;
            
            document.getElementById('questionTextMain').innerHTML = `
                <h2>üéâ Quiz Conclu√≠do!</h2>
                <p>Parab√©ns por completar o quiz sobre "A Velhinha Contrabandista"!</p>
            `;
            
            const historyHtml = gameHistory.map((game, index) => {
                const isCurrentGame = index === 0;
                const medal = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : 'üèÖ';
                const highlight = isCurrentGame ? 'style="background: #ffffcc; font-weight: bold;"' : '';
                return `
                    <div ${highlight}>
                        ${medal} ${formatTime(game.totalTime)} - ${game.accuracy}% - ${game.rounds} rodada(s) - ${game.date}
                    </div>
                `;
            }).join('');
            
            document.getElementById('statsContent').innerHTML = `
                <div style="font-size: 1.2em; margin-bottom: 15px;">üìä Resultados Finais</div>
                <div>‚è±Ô∏è Tempo total: ${formatTime(totalGameTimeSeconds)}</div>
                <div>üîÑ Rodadas necess√°rias: ${currentRound}</div>
                <div>‚úÖ Total de tentativas: ${gameStats.questionsAnswered}</div>
                <div>üéØ Precis√£o: ${accuracy}%</div>
                <div>üìà Posi√ß√£o no ranking: ${currentPosition}¬∫ lugar</div>
                <div>üèÜ ${accuracy >= 70 ? 'Excelente desempenho!' : accuracy >= 50 ? 'Bom trabalho!' : 'Continue estudando!'}</div>
                <br>
                <div style="font-size: 1.1em; margin-bottom: 10px;">üèÜ Hist√≥rico (5 √∫ltimas tentativas):</div>
                ${historyHtml || '<div>Nenhum hist√≥rico anterior</div>'}
            `;
            
            document.getElementById('startBtn').textContent = 'üîÑ Refazer Quiz';
            document.getElementById('startBtn').style.display = 'inline-block';
        }
        
        // Fun√ß√£o para formatar tempo em mm:ss
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            return `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
        }

        // Fun√ß√£o para mostrar ajuda
        function showHelp() {
            const question = questions[currentQuestionIndex];
            document.getElementById('helpQuestionNumber').textContent = currentQuestionIndex + 1;
            document.getElementById('helpText').innerHTML = `
                <h4>Resposta Correta: ${String.fromCharCode(97 + question.correct)}) ${question.options[question.correct]}</h4>
                <p><strong>Explica√ß√£o:</strong></p>
                <p>${question.explanation}</p>
            `;
            document.getElementById('textReference').textContent = cronicaText;
            document.getElementById('helpModal').style.display = 'block';
        }

        // Fun√ß√£o para fechar ajuda
        function closeHelp() {
            document.getElementById('helpModal').style.display = 'none';
        }

        // Fun√ß√£o para voltar aos temas
        function goBack() {
            window.close();
            // Se n√£o conseguir fechar, redirecionar
            setTimeout(() => {
                window.location.href = 'index_temas.html';
            }, 100);
        }

        // Remover anima√ß√£o bounce ap√≥s completar
        document.addEventListener('animationend', function(e) {
            if (e.animationName === 'bounce') {
                e.target.classList.remove('bounce');
            }
        });

        // Fechar modal clicando fora dele
        window.onclick = function(event) {
            const modal = document.getElementById('helpModal');
            if (event.target === modal) {
                closeHelp();
            }
        }
    </script>
</body>
</html>